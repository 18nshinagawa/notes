(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(e,t,n){e.exports=n(37)},29:function(e,t,n){},30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a,o=n(0),i=n.n(o),r=n(20),l=n.n(r),d=(n(29),n(8)),c=n(9),s=n(11),m=n(10),g=n(12),u=(n(30),n(21)),f=n(5),p=n(15),y=n.n(p),h=(n(31),n(32),function(e){function t(){return Object(d.a)(this,t),Object(s.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(u.a,null,i.a.createElement(f.a,{path:"/notes/*",component:function(e){var t=e.match;return"/notes/"===t.url?i.a.createElement(v,null):i.a.createElement(E,{file:t.url.replace("/notes/","")})}}))}}]),t}(i.a.Component)),v=function(e){function t(){return Object(d.a)(this,t),Object(s.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("pageshow",function(e){document.getElementById("files").innerHTML="";var t={};caches.open("files").then(function(e){e.keys().then(function(e){e.forEach(function(e){var n=e.url.replace("https://18nshinagawa.github.io/notes/","").split("/"),a=t;n.forEach(function(t,o){if(!a[t])if(o===n.length-1)try{a[t]=e.url.replace("https://18nshinagawa.github.io/notes/","")}catch(i){console.error(i)}else a[t]={};a=a[t]})}),function e(t,n){"element"===typeof t?Object.keys(t).forEach(function(a){var o=document.createElement("div");o.innerText=a,n.append(o),e(t[a],o)}):n.innerHTML='<a href="'+t+'">'+t.replace(/.*\//,"")+"</a>"}(t,document.getElementById("files"))})})})}},{key:"render",value:function(){return i.a.createElement("div",{id:"container"},i.a.createElement("div",{id:"files"}))}}]),t}(i.a.Component),E=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).element="",n.placeholders={math:["math"],code:["code","language"],image:["url","text"],link:["url","text"]},n.images={},n.display=!1,n.languages=["python","java","html","css","javascript"],n.undo=0,n.keyboard=!1,n.keys={Space:" ",Backspace:"delete",Enter:"return",Tab:"tab"," ":" ",CapsLock:"caps lock",ArrowRight:"right",ArrowLeft:"left",ArrowUp:"up",ArrowDown:"down",Backquote:"`",Minus:"-",Equal:"=",BracketLeft:"[",BracketRight:"]",Backslash:"\\",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/",ShiftLeft:"shift-left",ShiftRight:"shift-right",ControlLeft:"control-left",ControlRight:"control-right",AltLeft:"option-left",AltRight:"option-right",OSLeft:"command-left",OSRight:"command-right"},n.style='\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">\n    <style>\n\n    body {\n        margin: 0;\n        background-color: #333333;\n        overflow-x: hidden;\n    }\n\n    #editor {\n        width: 21cm;\n        padding: 2.5cm;\n        background-color: white;\n        color: #333333;\n        outline: none;\n        font-family: \'KaTeX_Main\', serif;\n        line-height: 1.5;\n        word-break: break-word;\n        caret-color: #4488FF;\n        margin: 1.25cm auto;\n        box-sizing: border-box;\n        transition: border-color 0.15s;\n    }\n\n    #editor.saved {\n        border-left: 2px solid #00BB66;\n    }\n\n    #editor.unsaved {\n        border-left: 2px solid #FF4444;\n    }\n    \n    ::-moz-selection {\n        background-color: rgba(68, 136, 255, 0.25);\n    }\n    \n    #editor > :first-child {\n        margin-top: 0;\n    }\n    \n    #editor > :last-child {\n        margin-bottom: 0;\n    }\n\n    h1, h2, h3 {\n        font-weight: normal;\n        text-align: center;\n    }\n    \n    img {\n        width: 10.5cm;\n        display: block;\n        margin: auto;\n    }\n\n    :-moz-broken, :-moz-loading {\n        height: 7.4cm;\n        border: 2px solid red;\n        box-sizing: border-box;\n        text-align: center;\n        line-height: 7.4cm;\n        color: #FF4444;\n    }\n\n    :-moz-broken::after {\n        content: \'404 (not found)\';\n    }\n\n    .caption {\n        text-align: center;\n        margin-top: 0.5em;\n    }\n\n    .element[data-element="math"] {\n        max-width: 16cm;\n        overflow: hidden;\n        display: inline-flex;\n    }\n    \n    .element[data-element="math"].display {\n        display: block;\n    }\n\n    a {\n        color: #4488FF;\n    }\n    \n    blockquote {\n        margin: 1em 0;\n        padding: 1em;\n        border-left: 2px solid #333333;\n    }\n\n    blockquote > :first-child {\n        margin-top: 0;\n    }\n    \n    blockquote > :last-child {\n        margin-bottom: 0;\n    }\n    \n    ul, ol {\n        color: inherit;\n    }\n\n    [data-element="code"] {\n        background-color: #EEEEEE;\n        font-family: \'KaTeX_Typewriter\', monospace;\n        max-width: 16cm;\n        overflow: hidden;\n        display: inline;\n        color: #333333;\n    }\n\n    [data-element="code"].display {\n        white-space: pre-wrap;\n        display: block;\n        padding: 8px;\n        margin: 1em 0;\n    }\n\n    .token.string, .token.attr-value {\n        color: #FF8844;\n    }\n\n    .token.keyword, .token.boolean, .token.attr-name, .token.selector {\n        color: #AA44FF;\n    }\n\n    .token.function, .token.tag, .token.rule, .token.builtin {\n        color: #4488FF;\n    }\n\n    .token.class-name, .token.number, .token.doctype, .token.property {\n        color: #00BB66;\n    }\n\n    .token.punctuation {\n        color: #888888;\n    }\n\n    .token.regex, .token.parameter, .token.url {\n        color: #FF4444;\n    }\n\n    .token.comment {\n        color: #888888;\n    }\n\n    .token.operator {\n        color: #888888;\n    }\n\n    table {\n        border-collapse: collapse;\n        margin: auto;\n    }\n\n    td, th {\n        border: 2px solid black;\n        padding: 8px;\n    }\n    \n    .page-break {\n        display: block;\n        height: 0.3125cm;\n        width: calc(100% + 5cm);\n        background-color: #333333;\n        left: -2.5cm;\n        position: relative;\n        margin: 2.5cm 0;\n        -moz-user-select: none;\n    }\n    \n    @media print {\n        #editor {\n            margin: 0;\n            padding: 0;\n            color-adjust: exact;\n        }\n\n        .page-break {\n            page-break-after: always;\n            visibility: hidden;\n        }\n    }\n\n    @page {\n        margin: 2.5cm;\n    }\n\n    </style>\n    ',n}return Object(g.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;a=document.getElementById("iframe").contentWindow.document,caches.open("files").then(function(t){t.match("/notes/"+e.props.file).then(function(e){return e.text()}).then(function(t){a.getElementById("editor").innerHTML=t,e.handleInputIframe(),a.getElementById("editor").classList.remove("unsaved"),a.getElementById("editor").classList.add("saved")}).catch(function(t){e.handleInputIframe(),a.getElementById("editor").classList.remove("unsaved"),a.getElementById("editor").classList.add("saved")})}),a.open(),a.write("<!DOCTYPE html>"+this.style+'<div id="editor" spellcheck="false" contentEditable="true"></div>'),a.close(),a.execCommand("defaultParagraphSeparator",!1,"p"),a.getElementById("editor").addEventListener("click",function(t){e.handleClickIframe(t)}),document.addEventListener("keydown",function(t){var n=t.key.toLowerCase();"MacIntel"===navigator.platform&&t.metaKey||"MacIntel"!==navigator.platform&&t.ctrlKey?"sop".includes(n)?e.handleKeyDownIframe(t):"k"===t.key.toLowerCase()?(t.preventDefault(),e.keyboard=!e.keyboard,document.getElementById("keyboard").classList.toggle("keyboard")):e.handleKeyDown(t):e.handleKeyDown(t)}),a.addEventListener("keyup",function(e){var t=document.getElementById("iframe").contentWindow.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0);if(n.commonAncestorContainer.parentElement.classList.contains("element")){var o=a.createRange();o.selectNode(n.commonAncestorContainer.parentElement),t.removeAllRanges(),t.addRange(o)}}}),a.addEventListener("keydown",function(e){var t=document.getElementById("iframe").contentWindow.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0);if(n.commonAncestorContainer.parentElement.classList.contains("element")){var o=a.createRange();o.selectNode(n.commonAncestorContainer.parentElement),t.removeAllRanges(),t.addRange(o)}}}),window.addEventListener("blur",function(e){document.getElementById("keyboard").classList.remove("command"),document.getElementById("keyboard").classList.remove("shift"),Array.from(document.querySelectorAll(".down")).forEach(function(e){e.classList.remove("down")})}),a.getElementById("editor").addEventListener("copy",function(e){e.preventDefault();var t=document.getElementById("iframe").contentWindow.getSelection().getRangeAt(0).cloneContents(),n=document.createElement("div");n.id="clipboard-data",n.appendChild(t),e.clipboardData.setData("text/plain",n.outerHTML)}),document.addEventListener("paste",function(e){e.preventDefault(),document.execCommand("insertHTML",!1,e.clipboardData.getData("text/plain"))}),a.getElementById("editor").addEventListener("paste",function(e){e.preventDefault(),e.clipboardData.getData("text/plain").match(/<div id="clipboard-data">(.*)<\/div>/)?a.execCommand("insertHTML",!1,e.clipboardData.getData("text/plain").match(/<div id="clipboard-data">(.*)<\/div>/)[1]):a.execCommand("insertText",!1,e.clipboardData.getData("text/plain"))}),a.getElementById("editor").addEventListener("keydown",function(t){e.handleKeyDownIframe(t)}),a.getElementById("editor").addEventListener("keyup",function(t){e.keyboard&&e.handleKeyUp(t)}),a.getElementById("editor").addEventListener("input",function(t){e.handleInputIframe(t)}),window.addEventListener("beforeunload",function(e){a.getElementById("editor").classList.contains("saved")||e.preventDefault()}),a.addEventListener("mousedown",function(e){Array.from(a.querySelectorAll(".element")).forEach(function(e){e.style.MozUserSelect="all"})}),a.addEventListener("mouseup",function(e){Array.from(a.querySelectorAll(".element")).forEach(function(e){e.style.MozUserSelect=""})}),document.addEventListener("mouseup",function(t){e.handleKeyUp(t)})}},{key:"handleKeyDownIframe",value:function(e){var t,n=this,o=document.getElementById("iframe").contentWindow.getSelection();o.rangeCount&&3===(t=o.getRangeAt(0)).commonAncestorContainer.nodeType&&"editor"===t.commonAncestorContainer.parentElement.id&&a.execCommand("formatBlock",!1,"p");var i=e.key.toLowerCase();if(this.keyboard&&(e.preventDefault(),this.handleKeyDown(e)),"MacIntel"===navigator.platform&&e.metaKey||"MacIntel"!==navigator.platform&&e.ctrlKey)if("k"===i)e.preventDefault(),this.keyboard=!this.keyboard,document.getElementById("keyboard").classList.toggle("keyboard");else if(-1!=="123".indexOf(i))e.preventDefault(),a.execCommand("heading",!1,"h"+i);else if("0"===i)e.preventDefault(),a.execCommand("formatBlock",!1,"p");else if("l"===i)e.preventDefault(),a.execCommand(e.shiftKey?"insertOrderedList":"insertUnorderedList");else if("b"===i){var r;if(e.preventDefault(),t){r=t.cloneRange();var l=t.startContainer;for(o.removeAllRanges();l!==t.endContainer;)if(l.nextSibling&&l.nextSibling.classList&&l.nextSibling.classList.contains("element")){var d=t.cloneRange();d.setEndBefore(l.nextSibling),o.addRange(d),t.setStartAfter(l.nextSibling),l=t.startContainer}else{if(!l.nextSibling){o.addRange(t);break}l=l.nextSibling}}e.shiftKey||(a.execCommand("bold"),console.log(r))}else if("i"===i)e.preventDefault(),e.shiftKey||a.execCommand("italic");else if("jghm".includes(i))e.preventDefault(),e.shiftKey?(this.display=!0,document.getElementById("display").checked=!0):(this.display=!1,document.getElementById("display").checked=!1),this.element={j:"code",m:"math",h:"link",g:"image"}[i],this.undo=1,a.execCommand("insertHTML",!1,'<span class="selection '+(this.display?"display":"")+'"></span>'),document.getElementById("first").dataset.placeholder=this.placeholders[this.element][0],document.getElementById("second").dataset.placeholder=this.placeholders[this.element][1],document.getElementById("edit").style.top=a.querySelector(".selection").getBoundingClientRect().top+a.body.scrollTop+"px",document.getElementById("edit").classList.add("focus"),document.getElementById("first").innerHTML="<br>",document.getElementById("second").innerHTML="<br>",document.getElementById("first").focus(),"code"===this.element?document.getElementById("second").classList.add("error"):document.getElementById("second").classList.remove("error");else if("p"===e)e.preventDefault(),document.getElementById("iframe").contentWindow.print();else if("s"===i){if(e.preventDefault(),e.shiftKey){var c=new Blob([this.style+'<div id="editor" class="saved">'+a.getElementById("editor").innerHTML+"</div>"],{type:"text/html"}),s=window.document.createElement("a");s.href=window.URL.createObjectURL(c),s.download=(document.querySelector("title").innerText||"untitled")+".html",document.body.appendChild(s),s.click(),document.body.removeChild(s)}a.getElementById("editor").classList.remove("unsaved"),a.getElementById("editor").classList.add("saved"),caches.open("files").then(function(e){e.put("/notes/"+n.props.file,new Response(a.getElementById("editor").innerHTML))})}else if("o"===i)e.preventDefault(),document.getElementById("open").click();else if("Enter"===e.key){e.preventDefault();var m=document.getElementById("iframe").contentWindow.getSelection(),g=m.getRangeAt(0),u=!1,f=!1;if(3===g.commonAncestorContainer.nodeType&&"editor"===g.commonAncestorContainer.parentElement.id&&a.execCommand("formatBlock",!1,"p"),3!==g.commonAncestorContainer.nodeType&&(!g.nextSibling||g.nextSibling.classList&&g.nextSibling.classList.contains("page-break"))&&(u=!0),3!==g.commonAncestorContainer.nodeType&&g.Offset===g.commonAncestorContainer.childNodes.length&&(u=!0),g.commonAncestorContainer.nextSibling&&"BR"!==g.commonAncestorContainer.nextSibling.nodeName||!g.commonAncestorContainer.nodeValue||g.commonAncestorContainer.nodeValue.length!==g.endOffset||(f=!0,(!g.commonAncestorContainer.parentElement.nextSibling||g.commonAncestorContainer.parentElement.nextSibling.classList&&g.commonAncestorContainer.parentElement.nextSibling.classList.contains("page-break"))&&(u=!0)),0===g.startOffset&&g.startContainer.parentElement.firstChild===g.startContainer&&(!g.startContainer.parentElement.previousSibling||g.startContainer.parentElement.previousSibling.classList&&g.startContainer.parentElement.previousSibling.classList.contains("page-break")))return;if(3!==g.startContainer.nodeType&&0===g.startOffset&&!g.startContainer.previousSibling)return;if(0===g.startOffset&&g.commonAncestorContainer.parentElement===a.getElementById("editor").firstChild)return;if("editor"===g.commonAncestorContainer.parentElement.id&&g.commonAncestorContainer.previousSibling&&g.commonAncestorContainer.previousSibling.classList.contains("page-break")&&(!g.commonAncestorContainer.previousSibling||g.commonAncestorContainer.previousSibling.classList.contains("page-break")))return;if(u)a.execCommand("insertHTML",!1,'<div class="page-break"><br></div><p><br></p>');else if(a.execCommand("insertHTML",!1,'<div class="page-break"><br></div>'),f){var p=a.createRange();p.setStart(g.commonAncestorContainer.parentElement.nextSibling.nextSibling,0),p.setEnd(g.commonAncestorContainer.parentElement.nextSibling.nextSibling,0),m.removeAllRanges(),m.addRange(p)}else{var y=a.createRange();3===g.commonAncestorContainer.nodeType?(y.setStart(g.commonAncestorContainer.parentElement,0),y.setEnd(g.commonAncestorContainer.parentElement,0)):(y.setStart(g.commonAncestorContainer,0),y.setEnd(g.commonAncestorContainer,0)),m.removeAllRanges(),m.addRange(y)}}else if("Backspace"===e.key){var h=document.getElementById("iframe").contentWindow.getSelection().getRangeAt(0);0===h.startOffset&&h.startContainer.parentElement.previousSibling&&h.startContainer.parentElement.previousSibling.classList.contains("page-break")?e.preventDefault():h.commonAncestorContainer.previousSibling&&h.commonAncestorContainer.previousSibling.classList.contains("page-break")&&e.preventDefault()}else"afxcrd".includes(i)&&e.shiftKey?e.preventDefault():"ru".includes(i)&&e.preventDefault();else if("Tab"===e.key)e.preventDefault(),e.shiftKey?a.execCommand("outdent"):a.execCommand("indent");else if("Backspace"===e.key){var v=document.getElementById("iframe").contentWindow.getSelection(),E=v.getRangeAt(0);if(E.startContainer===E.endContainer&&E.startOffset===E.endOffset)if(E.startContainer.previousSibling&&0===E.startOffset&&E.startContainer.previousSibling.classList.contains("element")){e.preventDefault();var b=a.createRange();b.selectNode(E.startContainer.previousSibling),v.removeAllRanges(),v.addRange(b)}else if(E.startContainer.childNodes&&E.startContainer.childNodes[E.startOffset-1]&&E.startContainer.childNodes[E.startOffset-1].classList&&E.startContainer.childNodes[E.startOffset-1].classList.contains("element")){e.preventDefault();var k=a.createRange();k.selectNode(E.startContainer.childNodes[E.startOffset-1]),v.removeAllRanges(),v.addRange(k)}else if(0===E.startOffset&&E.startContainer.parentElement.previousSibling&&E.startContainer.parentElement.previousSibling.classList.contains("page-break")){e.preventDefault();var C=a.createRange();C.setStartAfter(E.startContainer.parentElement.previousSibling.previousSibling.firstChild),C.setEndBefore(E.startContainer.parentElement),v.removeAllRanges(),v.addRange(C),a.execCommand("delete");var I=a.createRange();I.setStart(C.startContainer.nextSibling,0),I.setEnd(C.startContainer.nextSibling,0),v.removeAllRanges(),v.addRange(I)}else if(E.commonAncestorContainer.previousSibling&&E.commonAncestorContainer.previousSibling.classList.contains("page-break")){e.preventDefault();var B=a.createRange();B.setStartAfter(E.startContainer.previousSibling.previousSibling.firstChild),B.setEndBefore(E.startContainer),v.removeAllRanges(),v.addRange(B),a.execCommand("delete");var w=a.createRange();w.setStart(B.startContainer.nextSibling,0),w.setEnd(B.startContainer.nextSibling,0),v.removeAllRanges(),v.addRange(w)}}}},{key:"handleClickIframe",value:function(e){var t;if(e?(t=e.target.closest(".element"),a.querySelector(".selection")&&a.querySelector(".selection").classList.remove("selection")):t=a.querySelector(".selection"),t){var n=document.getElementById("iframe").contentWindow.getSelection();n.removeAllRanges(),t.classList.add("selection"),document.getElementById("first").innerHTML=t.dataset.first.replace(/\n$/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")||"<br>",document.getElementById("second").innerHTML=(t.dataset.second||"").replace(/\n$/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")||"<br>",this.undo=0,"code"!==e.target.closest(".element").dataset.element||this.languages.includes(document.getElementById("second").innerText)?document.getElementById("second").classList.remove("error"):document.getElementById("second").classList.add("error"),document.getElementById("edit").classList.add("focus"),document.getElementById("edit").style.top=t.getBoundingClientRect().top+a.body.scrollTop+"px",this.element=t.dataset.element,t.classList.contains("display")?(this.display=!0,document.getElementById("display").checked=!0):(this.display=!1,document.getElementById("display").checked=!1),document.getElementById("first").dataset.placeholder=this.placeholders[this.element][0],document.getElementById("second").dataset.placeholder=this.placeholders[this.element][1],n=window.getSelection();var o=document.createRange();o.setStartAfter(document.getElementById("first").firstChild),n.removeAllRanges(),n.addRange(o)}else document.getElementById("edit").classList.remove("focus")}},{key:"handleInputIframe",value:function(e){var t=document.getElementById("iframe").contentWindow.getSelection(),n=t.getRangeAt(0);if(n.commonAncestorContainer.parentElement.classList.contains("element")){var o=a.createRange();o.selectNode(n.commonAncestorContainer.parentElement),t.removeAllRanges(),t.addRange(o)}if(document.querySelector("title").innerText=this.props.file.replace(/.*\//,""),Array.from(a.getElementsByTagName("h1")).forEach(function(e,t){e.id=e.innerText.replace(/\s/g,""),0===t&&(document.querySelector("title").innerText=e.innerText)}),Array.from(a.querySelectorAll("h2, h3")).forEach(function(e){e.id=e.innerText.replace(/\s/g,"")}),"editor"!==n.startContainer.id&&"editor"===n.endContainer.id){var i=a.createRange();i.setStart(n.startContainer.nextSibling.nextSibling,0),t.removeAllRanges(),t.addRange(i)}document.getElementById("iframe").style.height=a.getElementById("editor").clientHeight+96+"px",a.getElementById("editor").classList.remove("saved"),a.getElementById("editor").classList.add("unsaved")}},{key:"handleInput",value:function(e){var t=this;if(a.querySelector(".selection")){var n=a.createRange(),o=document.getElementById("iframe").contentWindow.getSelection();n.selectNode(a.querySelector(".selection")),o.removeAllRanges(),o.addRange(n)}a.getElementById("editor").focus();var i=document.getElementById("first").innerText.replace(/\n$/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),r=document.getElementById("second").innerText.replace(/\n$/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");document.documentElement.scrollTop;this.undo>0&&a.execCommand("undo"),"image"===this.element?i.match(/\S+/g)?caches.open("files").then(function(e){e.match("/images/"+i.replace(/^https:\/\/18nshinagawa\.github\.io\/images\//,"")).then(function(e){return e.text()}).then(function(e){var n=e.replace(/\n$/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");if(a.querySelector(".selection")){var o=document.getElementById("iframe").contentWindow.getSelection(),l=a.createRange();l.selectNode(a.querySelector(".selection")),o.removeAllRanges(),o.addRange(l)}a.execCommand("insertHTML",!1,'<div class="selection element" data-element="image" data-first="'+i+'" data-second="'+r+'"><div class="image"><img src="'+n+'" alt=" "/></div><div class="caption">'+r+"</div></div>"),t.undo++,document.getElementById("iframe").style.height=a.getElementById("editor").clientHeight+376+"px",a.querySelector(".selection img").onload=function(){document.getElementById("iframe").style.height=a.getElementById("editor").clientHeight+96+"px"}}).catch(function(e){if(a.querySelector(".selection")){var n=document.getElementById("iframe").contentWindow.getSelection(),o=a.createRange();o.selectNode(a.querySelector(".selection")),n.removeAllRanges(),n.addRange(o)}a.execCommand("insertHTML",!1,'<div class="selection element" data-element="image" data-first="'+i+'" data-second="'+r+'"><div class="image"><img src="'+i+'" alt=" "/></div><div class="caption">'+r+"</div></div>"),t.undo++,document.getElementById("iframe").style.height=a.getElementById("editor").clientHeight+376+"px",a.querySelector(".selection img").onload=function(){document.getElementById("iframe").style.height=a.getElementById("editor").clientHeight+96+"px"}})}):a.execCommand("delete"):"link"===this.element?r.match(/\S+/g)?(a.execCommand("insertHTML",!1,'<span class="selection element" data-element="link" data-first="'+i+'" data-second="'+r+'"><a href="'+i+'">'+r+"</a></span>"),this.undo++):a.execCommand("delete"):"math"===this.element?i.match(/\S+/g)?(a.execCommand("insertHTML",!1,'<span class="selection element '+(this.display?"display":"")+'" data-element="math" data-first="'+i+'">'+window.katex.renderToString(document.getElementById("first").innerText,{displayMode:this.display,throwOnError:!1,errorColor:"#DD4433"})+"</span>"),this.undo++):a.execCommand("delete"):"code"===this.element&&(i.match(/\S+/g)?this.languages.includes(r)?(document.getElementById("second").classList.remove("error"),a.execCommand("insertHTML",!1,'<span class="selection element '+(this.display?"display":"")+'" data-element="code" data-first="'+i+'" data-second="'+r+'">'+y.a.highlight(i,y.a.languages[r],r)+"</span>"),this.undo++):(document.getElementById("second").classList.add("error"),a.execCommand("insertHTML",!1,'<span class="selection element '+(this.display?"display":"")+'" data-element="code" data-first="'+i+'" data-second="'+r+'">'+i+"</span>"),this.undo++):a.execCommand("delete")),a.querySelector(".selection")&&(document.getElementById("edit").style.top=a.querySelector(".selection").getBoundingClientRect().top+a.body.scrollTop+"px"),e&&e.target&&e.target.focus()}},{key:"handleKeyDown",value:function(e){if(this.keyboard){if(e.preventDefault(),"Escape"===e.code)return this.keyboard=!1,void document.getElementById("keyboard").classList.remove("keyboard");e.code.match("Digit")?document.getElementById(e.code.replace("Digit","")).classList.add("down"):e.code.match("Key")?document.querySelector(".row:not(:first-child) #"+e.code.replace("Key","").toLowerCase()).classList.add("down"):Object.keys(this.keys).includes(e.code)&&document.getElementById(this.keys[e.code]).classList.add("down"),e.shiftKey&&document.getElementById("keyboard").classList.add("shift"),("MacIntel"===navigator.platform&&e.metaKey||"MacIntel"!==navigator.platform&&e.ctrlKey)&&document.getElementById("keyboard").classList.add("command")}else if(" "===e.key)document.querySelector(":focus")&&"display"===document.querySelector(":focus").id&&(document.getElementById("display").checked=!document.getElementById("display").checked,this.handleClick({target:document.getElementById("display")}));else if("Escape"===e.key||("MacIntel"===navigator.platform&&e.metaKey||"MacIntel"!==navigator.platform&&e.ctrlKey)&&{math:"m",code:"j",link:"h",image:"g"}[this.element]===e.key.toLowerCase())if(e.preventDefault(),document.getElementById("first").innerText.match(/\S+/g)){var t=a.createRange(),n=document.getElementById("iframe").contentWindow.getSelection();t.setStartAfter(a.querySelector(".selection")),t.setEndAfter(a.querySelector(".selection")),n.removeAllRanges(),n.addRange(t),a.getElementById("editor").focus(),document.getElementById("edit").classList.remove("focus"),a.querySelector(".selection").classList.remove("selection")}else document.getElementById("edit").classList.remove("focus"),a.getElementById("editor").focus();else if("MacIntel"===navigator.platform&&e.metaKey||"MacIntel"!==navigator.platform&&e.ctrlKey)("afxcbghjmrd".includes(e.key.toLowerCase())&&e.shiftKey||"ibujghmrld".includes(e.key.toLowerCase())&&!e.shiftKey)&&e.preventDefault();else if("Tab"===e.key)if("display"===e.target.id){e.preventDefault();var o=window.getSelection(),i=document.createRange();e.shiftKey&&"undefined"!==document.getElementById("second").dataset.placeholder?(i.setStartBefore(document.getElementById("second").lastChild),o.removeAllRanges(),o.addRange(i)):(i.setStartBefore(document.getElementById("first").lastChild),o.removeAllRanges(),o.addRange(i))}else if("first"===e.target.id)if(e.preventDefault(),e.shiftKey||"undefined"===document.getElementById("second").dataset.placeholder)document.getElementById("display").focus();else{var r=window.getSelection(),l=document.createRange();l.setStartBefore(document.getElementById("second").lastChild),r.removeAllRanges(),r.addRange(l)}}},{key:"delete",value:function(e){var t=document.getElementById("iframe").contentWindow.getSelection(),n=a.createRange();n.selectNode(a.querySelector(".selection")),t.removeAllRanges(),t.addRange(n),a.execCommand("delete")}},{key:"handleChange",value:function(e){if("open"===e.target.id){var t=e.target.files[0],n=new FileReader;n.onload=function(e){a.getElementById("editor").focus(),a.execCommand("selectAll"),a.execCommand("insertHTML",!1,e.target.result.match(/<div id="editor">([\0-\uFFFF]*)<\/div>/)[1])},n.readAsText(t)}}},{key:"handleClick",value:function(e){this.display=!this.display,"display"===e.target.id?this.handleInput(e):(e.preventDefault(),document.getElementById("display").checked=!document.getElementById("display").checked,this.handleInput(),document.getElementById("display").focus())}},{key:"handleKeyUp",value:function(e){e.preventDefault(),e.code.match("Digit")?document.getElementById(e.code.replace("Digit","")).classList.remove("down"):e.code.match("Key")?document.querySelector(".row:not(:first-child) #"+e.code.replace("Key","").toLowerCase()).classList.remove("down"):Object.keys(this.keys).includes(e.code)&&document.getElementById(this.keys[e.code]).classList.remove("down"),e.shiftKey||document.getElementById("keyboard").classList.contains("shift")&&(document.getElementById("keyboard").classList.remove("shift"),document.querySelectorAll(".down")&&Array.from(document.querySelectorAll(".down")).forEach(function(e){e.classList.remove("down")})),"MacIntel"===navigator.platform&&e.metaKey||"MacIntel"!==navigator.platform&&e.ctrlKey||document.getElementById("keyboard").classList.contains("command")&&(document.getElementById("keyboard").classList.remove("command"),document.querySelectorAll(".down")&&Array.from(document.querySelectorAll(".down")).forEach(function(e){e.classList.remove("down")}))}},{key:"handleDrop",value:function(e){e.preventDefault();var t=e.dataTransfer.files[0],n=e.target,a=new FileReader;a.onload=function(e){caches.open("files").then(function(n){n.put("/images/"+t.name,new Response(e.target.result))}),document.execCommand("selectAll"),document.execCommand("insertText",!1,"https://18nshinagawa.github.io/images/"+t.name)},"first"===n.id&&"image"===this.element&&a.readAsDataURL(t)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{id:"editor"},i.a.createElement("div",{id:"keyboard"},[[["esc"],["empty"],["empty"],["empty"],["empty"],["empty"],["k","K"],["e","E"],["y","Y"],["b","B"],["o","O"],["a","A"],["r","R"],["d","D"]],[["`","~"],["1","!","heading 1"],["2","@","heading 2"],["3","#","heading 3"],["4","$"],["5","%"],["6","^"],["7","&"],["8","*"],["9","("],["0",")","paragraph"],["-","_"],["=","+"],["delete"]],[["tab"],["q","Q"],["w","W"],["e","E"],["r","R"],["t","T"],["y","Y"],["u","U"],["i","I","italicize"],["o","O","open","open"],["p","P","print"],["[","{"],["]","}"],["\\","|"]],[["caps lock"],["a","A","select all"],["s","S","save","download"],["d","D"],["f","F","find"],["g","G","image"],["h","H","link"],["j","J","inline code","display code"],["k","K","keyboard"],["l","L","unordered list","ordered list"],[";",":"],["'",'"'],["return","return","page break"]],[["shift-left"],["z","Z","undo","redo"],["x","X","cut"],["c","C","copy"],["v","V","paste"],["b","B","bold"],["n","N"],["m","M","inline math","display math"],[",","<"],[".",">"],["/","?"],["shift-right"]],[["control-left"],["option-left"],["command-left"],[" "],["command-right"],["option-right"],["control-right"],["left"],["up"],["down"],["right"]]].map(function(e,t){return i.a.createElement("div",{key:t,className:"row"},e.map(function(e,t){return i.a.createElement("div",{key:t,className:"key",id:e[0],"data-shift":e[1]||e[0],"data-command":e[2]||e[0],"data-both":e[3]||e[1]||e[0]})}))}),i.a.createElement("input",{type:"text"})),i.a.createElement("div",{id:"edit"},i.a.createElement("pre",{id:"first",spellCheck:"false",contentEditable:"true",onInput:function(t){return e.handleInput(t)},onDrop:function(t){return e.handleDrop(t)}}),i.a.createElement("pre",{id:"second",spellCheck:"false",contentEditable:"true",onInput:function(t){return e.handleInput(t)}}),i.a.createElement("label",{id:"label",onClick:function(t){return e.handleClick(t)}},i.a.createElement("input",{type:"checkbox",id:"display"}),i.a.createElement("span",null),i.a.createElement("div",null))),i.a.createElement("input",{id:"open",type:"file",onChange:function(t){return e.handleChange(t)}}),i.a.createElement("iframe",{id:"iframe",title:"iframe"}))}}]),t}(i.a.Component),b=h,k=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function C(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}l.a.render(i.a.createElement(b,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/notes",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/notes","/service-worker.js");k?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):C(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):C(t,e)})}}()}},[[24,1,2]]]);
//# sourceMappingURL=main.f4274cdf.chunk.js.map